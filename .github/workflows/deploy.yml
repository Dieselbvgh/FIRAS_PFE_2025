kdeploy:
  runs-on: self-hosted  # â† THIS IS THE KEY CHANGE!
  needs: test
  steps:
  - uses: actions/checkout@v4
  - name: ğŸš€ Deploy Application
    run: |
      echo "=== ğŸš€ STARTING DEPLOYMENT ==="
      cd /home/ubuntu/FIRAS_PFE_2025
      
      echo "ğŸ“¥ Pulling latest code..."
      git pull origin main
      
      echo "ğŸ“¦ Installing dependencies..."
      npm install
      
      echo "ğŸ”„ Restarting application with PM2..."
      pm2 reload devsecops-dashboard --update-env
      
      echo "â³ Waiting for restart..."
      sleep 8
      
      echo "ğŸ” Checking application status..."
      if curl -f http://localhost:3000/health; then
        echo "=== âœ… DEPLOYMENT SUCCESS! ==="
        echo "ğŸŒ Dashboard: http://localhost:3000"
        echo "ğŸ“Š PM2 Status:"
        pm2 status
      else
        echo "=== âŒ DEPLOYMENT FAILED ==="
        echo "ğŸ“‹ Checking PM2 logs..."
        pm2 logs --lines 10
        exit 1
      fi
